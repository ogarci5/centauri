<p id="notice"><%= notice %></p>
<div class="panel panel-default">
  <div class="panel-body">
    <h5>Groups</h5>
    <ul id="group_nav" class="nav nav-pills">
      <%@groups.each do |group|%>
        <li id="<%=group.name.parameterize%>"><a><%=group.name.titleize%></a></li>
      <%end%>
    </ul>
    <h5>Types</h5>
    <ul id="type_nav" class="nav nav-pills">
      <li id="image"><a>Images</a></li>
      <li id="gif"><a>Gifs</a></li>
      <li id="shuffle"><a>Shuffle</a></li>
      <li id="group_filter"><a>Group Filter</a></li>
    </ul>
  </div></div>
<div id="destroyModal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <p>Are you sure you want to delete this resource?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
        <%=link_to 'Yes', '', class: 'btn btn-primary', method: :delete%>
      </div>
    </div>
  </div>
</div>
<div>
  <%= toggle_groups_button(cookies[:toggle_groups] == 'true' ? true : false) %>
  <a class="btn btn-default" href="/resources/new">New Resource</a>
</div>
<div class="row col-md-12">
  <%@resources.each do |resource|%>
    <div class="col-md-12">
      <%if resource.type == 'video'%>
        <video class="resource-content" src="<%=resource.location%>" autoplay="" loop="" controls="">
        </video>
      <%elsif resource.type == 'octet-stream'%>
        <video class="resource-content" src="<%=resource.location%>" autoplay="" loop="" controls="">
        </video>
      <%elsif resource.type == 'swf'%>
        <embed class="resource-content" src="<%=resource.location%>">
      <%else%>
        <%= image_tag resource.location, class: 'resource-content' %>
      <%end%>
      <form id="form-<%=resource.id%>" class="resource-group-form">
        <a data-href="<%=resource_path(resource)%>" class="resource-close close">&times;</a>
        <%@main_groups.each do |group|%>
          <label class="checkbox-inline">
            <input id="group-<%=group.id%>-<%=resource.id%>" onclick="add_group(this.checked, <%=resource.id%>, <%=group.id%>)"
                   type="checkbox" value="<%=group.name%>" <%= resource.groups.member?(group) ? 'checked="true"' : ''%>> <%=group.name.titleize%>
          </label>
        <%end%>
      </form>
    </div>
  <%end%>
  <a class="btn btn-default" href="#brand">Back to Top</a>
  <%= will_paginate @resources, renderer: BootstrapPagination::Rails %>
</div>
<script>
  function check_nav() {
    $('.nav li').removeClass('active');
    <%params.each do |key, value|%>
      <%if key == 'groups'%>
        <%value.each do |group, val|%>
          if(<%=val%>) $('#<%=group%>').addClass('active');
        <%end%>
      <%elsif key == 'types'%>
        <%value.each do |type, val|%>
          if(<%=val%>) $('#<%=type%>').addClass('active');
        <%end%>
      <%end%>
    <%end%>
  }

  function set_group_forms(toggle) {
    toggle ? $('.resource-group-form').show() : $('.resource-group-form').hide();
  }

  $('#toggle-groups').click(function() {
    $('.resource-group-form').toggle();
    $.ajax({
      url: "<%=toggle_groups_path%>",
      type: "GET",
      dataType: "html"
    });
  });

  $('.resource-close').click(function() {
    var href = $(this).attr('data-href');
    $('#destroyModal a').attr('href', href);
    $('#destroyModal').modal('show');
  });

  $(".nav-pills li").click(function() {
    var id  = $(this).attr('id');

    if((id == 'image' || id == 'gif') && !$(this).hasClass('active')) {
      $('#image').removeClass('active');
      $('#gif').removeClass('active');
    }
    $(this).toggleClass('active');

    var group_filter = $("#group_nav.nav-pills li.active"),
        type_filter = $("#type_nav.nav-pills li.active"),
        groups = [],
        types = [];

    for(var i=0; i < group_filter.length; i++ ) {
      groups[i] = 'groups['+group_filter[i].id+']=true';
    }

    for(i=0; i < type_filter.length; i++ ) {
      types[i] = 'types['+type_filter[i].id+']=true';
    }
    var query = groups.concat(types);
    window.location.search = '?'+query.join('&');
  });

  $(function() {
    check_nav();
    set_group_forms(<%= cookies[:toggle_groups] == 'true' ? true : false %>);
  });
</script>
